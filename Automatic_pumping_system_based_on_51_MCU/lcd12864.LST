C51 COMPILER V9.54   LCD12864                                                              01/03/2018 01:59:30 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE LCD12864
OBJECT MODULE PLACED IN lcd12864.OBJ
COMPILER INVOKED BY: D:\Program Files\Keil_v5\C51\BIN\C51.EXE lcd12864.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TAB
                    -S(2)

line level    source

   1          /*******************************************************************************
   2          * 作    者        : 李城权
   3          * 模块名称        : LCD12864显示
   4          * 输    入        : 字符串
   5          * 输    出        : 无
   6          *******************************************************************************/
   7          
   8          
   9          #include"lcd12864.h"
  10          //#include"key.h"
  11          
  12          /*******************************************************************************
  13          * 函 数 名         : LCD12864_Delay1ms
  14          * 函数功能       : 延时1MS
  15          * 输    入         : c
  16          * 输    出         : 无
  17          *******************************************************************************/
  18          
  19          void LCD12864_Delay1ms(uint c)
  20          {
  21   1          uchar a,b;
  22   1        for(; c>0; c--)
  23   1        {
  24   2            for(b=199; b>0; b--)
  25   2          {
  26   3                for(a=1; a>0; a--);
  27   3          }
  28   2        }
  29   1      }
  30          
  31          /*******************************************************************************
  32          * 函 数 名         : Delay10ms
  33          * 函数功能         : 延时10MS
  34          * 输    入         : c
  35          * 输    出         : 无
  36          *******************************************************************************/
  37          
  38          void Delay10ms(unsigned int c)   //误差 0us
  39          {
  40   1          unsigned char a, b;
  41   1      
  42   1        //--c已经在传递过来的时候已经赋值了，所以在for语句第一句就不用赋值了--//
  43   1          for (;c>0;c--)
  44   1        {
  45   2          for (b=38;b>0;b--)
  46   2          {
  47   3            for (a=130;a>0;a--);
  48   3          }
  49   2                 
  50   2        }
  51   1              
  52   1      }
  53          
  54          /*******************************************************************************
C51 COMPILER V9.54   LCD12864                                                              01/03/2018 01:59:30 PAGE 2   

  55          * 函 数 名         : LCD12864_Busy
  56          * 函数功能         : 检测LCD是否忙
  57          * 输    入         : 无
  58          * 输    出         : 1或0（1表示不忙，0表示忙）
  59          *******************************************************************************/
  60          
  61          uchar LCD12864_Busy(void)
  62          {
  63   1        uchar i = 0;
  64   1      
  65   1        LCD12864_RS = 0;    //选择命令
  66   1        LCD12864_RW = 1;  //选择读取
  67   1      
  68   1        LCD12864_EN = 1;
  69   1        LCD12864_Delay1ms(1);
  70   1      
  71   1        while((LCD12864_DATAPORT & 0x80) == 0x80) //检测读取到的值
  72   1        {
  73   2          i++;
  74   2          if(i > 100)
  75   2          {
  76   3            LCD12864_EN = 0;
  77   3            return 0;    //超过等待时间返回0表示失败
  78   3          }
  79   2        }
  80   1      
  81   1        LCD12864_EN = 0;
  82   1      
  83   1        return 1;
  84   1      }
  85          
  86          /*******************************************************************************
  87          * 函 数 名         : LCD12864_WriteCmd
  88          * 函数功能         : 写指令数据到LCD
  89          * 输    入         : cmd
  90          * 输    出         : 无
  91          *******************************************************************************/
  92          
  93          void LCD12864_WriteCmd(uchar cmd)
  94          {
  95   1        uchar i;
  96   1        i = 0;
  97   1        while( LCD12864_Busy() == 0)
  98   1        {
  99   2          LCD12864_Delay1ms(1);
 100   2          i++;
 101   2          if( i>100)
 102   2          {
 103   3            return;    //超过等待退出
 104   3          } 
 105   2        }
 106   1        
 107   1        LCD12864_RS = 0;     //选择命令
 108   1        LCD12864_RW = 0;     //选择写入
 109   1        LCD12864_EN = 0;     //初始化使能端
 110   1      
 111   1        LCD12864_DATAPORT = cmd;   //放置数据
 112   1      
 113   1        LCD12864_EN = 1;       //写时序
 114   1        LCD12864_Delay1ms(5);
 115   1        LCD12864_EN = 0;              
 116   1      }
C51 COMPILER V9.54   LCD12864                                                              01/03/2018 01:59:30 PAGE 3   

 117          
 118          /*******************************************************************************
 119          * 函 数 名         : LCD12864_WriteData
 120          * 函数功能         : 写数据
 121          * 输    入         : dat
 122          * 输    出         : 无
 123          *******************************************************************************/
 124          
 125          void LCD12864_WriteData(uchar dat)
 126          {
 127   1        uchar i;
 128   1        i = 0;
 129   1        while( LCD12864_Busy() == 0)
 130   1        {
 131   2          LCD12864_Delay1ms(1);
 132   2          i++;
 133   2          if( i>100)
 134   2          {
 135   3            return;    //超过等待退出
 136   3          } 
 137   2        }
 138   1      
 139   1        LCD12864_RS = 1;     //选择数据
 140   1        LCD12864_RW = 0;     //选择写入
 141   1        LCD12864_EN = 0;     //初始化使能端
 142   1      
 143   1        LCD12864_DATAPORT = dat;   //放置数据
 144   1      
 145   1        LCD12864_EN = 1;       //写时序
 146   1        LCD12864_Delay1ms(5);
 147   1        LCD12864_EN = 0;                    
 148   1      }
 149          
 150          /*******************************************************************************
 151          * 函 数 名         : LCD12864_ShowString
 152          * 函数功能         : 写字符串
 153          * 输    入         : 字符串
 154          * 输    出         : 无
 155          *******************************************************************************/
 156          void LCD12864_ShowString(uchar x,uchar y,const uchar *p)
 157          {
 158   1        uchar temp;
 159   1        if(x>3) {x=0;}
 160   1        if(y>7) {y=0;}
 161   1        LCD12864_SetWindow(x,y);
 162   1        temp=*p;
 163   1        while(temp!='\0')
 164   1        {
 165   2          LCD12864_WriteData(temp);
 166   2          temp=*(++p);
 167   2        } 
 168   1      }
 169          
 170          /*******************************************************************************
 171          * 函 数 名         : LCD12864_ReadData
 172          * 函数功能         : 读取数据
 173          * 输    入         : 无
 174          * 输    出         : 读取到的8位数据
 175          *******************************************************************************/
 176          #ifdef LCD12864_PICTURE
              
              uchar LCD12864_ReadData(void)
C51 COMPILER V9.54   LCD12864                                                              01/03/2018 01:59:30 PAGE 4   

              {
                uchar i, readValue;
              
                i = 0;
                while( LCD12864_Busy() == 0)
                {
                  LCD12864_Delay1ms(1);
                  i++;
                  if( i>100)
                  {
                    return 0;    //超过等待退出
                  } 
                }
              
                LCD12864_RS = 1;       //选择命令
                LCD12864_RW = 1;
                LCD12864_EN = 0;
                LCD12864_Delay1ms(1);  //等待
              
                LCD12864_EN = 1;
                LCD12864_Delay1ms(1);
                readValue = LCD12864_DATAPORT;
                LCD12864_EN = 0;
              
                return readValue;
              }
              
              #endif
 207          
 208          /*******************************************************************************
 209          * 函 数 名         : LCD12864_Init
 210          * 函数功能         : 初始化LCD12864
 211          * 输    入         : 无
 212          * 输    出         : 无
 213          *******************************************************************************/
 214          
 215          void LCD12864_Init()
 216          {
 217   1        LCD12864_PSB = 1;   //选择并行输入
 218   1        LCD12864_RST = 1;   //复位
 219   1        LCD12864_WriteCmd(0x30);  //选择基本指令操作
 220   1        LCD12864_WriteCmd(0x0c);  //显示开，关光标
 221   1        LCD12864_WriteCmd(0x01);  //清除LCD12864的显示内容
 222   1      }
 223          
 224          /*******************************************************************************
 225          * 函 数 名         : LCD12864_Clear
 226          * 函数功能       : 设置显示(位置)行数
 227          * 输    入         : 无
 228          * 输    出         : 无
 229          *******************************************************************************/
 230          //void  LCD12864_clear()
 231          //{
 232          //   LCD12864_WriteData(0x34);      //扩充指令操作
 233          //   LCD12864_Delay1ms(5);    
 234          //   LCD12864_WriteData(0x30);      //基本指令操作
 235          //   LCD12864_Delay1ms(5);
 236          //   LCD12864_WriteData(0x01);      //清屏 
 237          //   LCD12864_Delay1ms(5);    
 238          //}
 239          
 240          /*******************************************************************************
C51 COMPILER V9.54   LCD12864                                                              01/03/2018 01:59:30 PAGE 5   

 241          * 函 数 名         : LCD12864_ClearScreen
 242          * 函数功能         : 在画图模式下，LCD12864的01H命令不能清屏，所以要自己写一个清
 243          *                  * 屏函数
 244          * 输    入         : 无
 245          * 输    出         : 无
 246          *******************************************************************************/
 247          #ifdef LCD12864_PICTURE
              
              void LCD12864_ClearScreen(void)
              {
                uchar i,j;
              
                LCD12864_WriteCmd(0x34);    //开启拓展指令集
              
                for(i=0;i<32;i++)       //因为LCD有纵坐标32格所以写三十二次
                {
                  LCD12864_WriteCmd(0x80+i);      //先写入纵坐标Y的值
                  LCD12864_WriteCmd(0x80);      //再写入横坐标X的值
                  for(j=0;j<32;j++)     //横坐标有16位，每位写入两个字节的的数据，也
                  {             //就写入32次以为当写入两个字节之后横坐标会自
                    LCD12864_WriteData(0xFF);   //动加1，所以就不用再次写入地址了。
                  }
                }
              
                LCD12864_WriteCmd(0x36);   //0x36扩展指令里面打开绘图显示
                LCD12864_WriteCmd(0x30);   //恢复基本指令集
              }
              
              #endif
 270          /*******************************************************************************
 271          * 函 数 名         : LCD12864_SetWindow
 272          * 函数功能         : 设置在基本指令模式下设置显示坐标。注意：x是设置行，y是设置列
 273          * 输    入         : x, y
 274          * 输    出         : 无
 275          *******************************************************************************/
 276          
 277          void LCD12864_SetWindow(uchar x, uchar y)
 278          {
 279   1        uchar pos;
 280   1      
 281   1        if(x == 0)     // 第一行的地址是80H
 282   1        {
 283   2          x = 0x80;
 284   2        }
 285   1          
 286   1        else if(x == 1)  //第二行的地址是90H
 287   1        {
 288   2          x = 0x90; 
 289   2        }
 290   1        
 291   1        else if(x == 2)  //第三行的地址是88H
 292   1        {
 293   2          x = 0x88;
 294   2        }
 295   1        
 296   1        else if(x == 3)
 297   1        {
 298   2          x = 0x98;
 299   2        }
 300   1        
 301   1        pos = x + y;
 302   1        LCD12864_WriteCmd(pos);
C51 COMPILER V9.54   LCD12864                                                              01/03/2018 01:59:30 PAGE 6   

 303   1      }
 304          
 305          /*******************************************************************************
 306          * 函 数 名         : LCD12864_DrowPic
 307          * 函数功能         : 画图函数
 308          * 输    入         : 无
 309          * 输    出         : 无
 310          *******************************************************************************/
 311          #ifdef LCD12864_PICTURE
              
              void LCD12864_DrowPic(uchar *a)    
              {
              
                unsigned char i,j;
              
                LCD12864_ClearScreen();
              
                LCD12864_WriteCmd(0x34);      //开启扩展指令集，并关闭画图显示。
                for(i=0;i<32;i++)       //因为LCD有纵坐标32格所以写三十二次
                {
                  
                  LCD12864_WriteCmd(0x80+i);      //先写入纵坐标Y的值
                  LCD12864_WriteCmd(0x80);      //再写入横坐标X的值
                  for(j=0; j<16; j++)     //横坐标有16位，每位写入两个字节的的数据，也
                  {             //就写入32次以为当写入两个字节之后横坐标会自
                    LCD12864_WriteData(*a);         //动加1，所以就不用再次写入地址了。
                    a++;
                  }
                }  
                for(i=0; i<32; i++)       //因为LCD有纵坐标32格所以写三十二次
                {
                  
                  LCD12864_WriteCmd(0x80+i);      //先写入纵坐标Y的值
                  LCD12864_WriteCmd(0x88);      //再写入横坐标X的值
                  for(j=0; j<16; j++)     //横坐标有16位，每位写入两个字节的的数据，也
                  {             //就写入32次以为当写入两个字节之后横坐标会自
                    LCD12864_WriteData(*a);         //动加1，所以就不用再次写入地址了。
                    a++;    }
                } 
              
                LCD12864_WriteCmd(0x36);     //开显示
                LCD12864_WriteCmd(0x30);       //转回基本指令集
              }
              
              #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    272    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
